<html>
<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>阳光之道</title>
    <script src="js/jquery-3.1.0.min.js"></script>
</head>

<link type="text/css" rel="stylesheet" href="css/main.css">

<body>
<!-- Loading -->
<div id="loading_page" class="page_full">
    <img id="bg" src="resource/bg.png" width="100%" height="100%" />
    <div style="position: absolute; text-align: center;top: 80px;width: 100%">
        <img id="logo" src="resource/logo_s1.png" style="width:200px;height:200px"  />
    </div>
    <div style="position: absolute; text-align: center;bottom: 50px;width: 100%">
        <div style=""><canvas id="cv"></canvas></div>
        <img id="stage" src="resource/stage.png" style="width:250px"  />
    </div>

</div>
<!-- 第二页 -->
<div  id="start_page" style="display: none" class="page_full">
    <img id="bg2" src="resource/bg2.png" width="100%" height="100%" />
    <div style="position: absolute; text-align: center;top: 70px;width: 100%">
        <img id="logo_start" src="resource/logo_start.png" style="width:236px;height:345px"  />
    </div>
    <div style="position: absolute; text-align: center;bottom: 30px;width: 100%">
        <div style="margin-bottom: 50px"><img id="go_btn" src="resource/go.png" style="width:117px;height: 41px;"/></div>
        <div style="margin-right: 30px"><img id="logo_bottom" src="resource/logo_bottom.png" style="width:127px;height: 27px"  /></div>
    </div>
</div>
<!-- 视频 -->
<div id="pageWrap" style="overflow: hidden; display: none;">
    <div class="page page-1-1 page-current ">
        <div class="zoom-page " style="transform: scale(0.444444, 0.444444); height: 1441px;">
            <video id="video" preload="auto" data-index="1" x-webkit-airplay="" playsinline="" webkit-playsinline=""
                   x5-video-player-fullscreen="false" x5-video-player-type="h5"
                   width="100%" height="100%" poster="" src="resource/m.mp4" style="object-fit: fill;"></video>
        </div>
    </div>
    <div id="desc" style="display:none;position: absolute;width: 100%;bottom: 0px;left: 0px;text-align: center;z-index: 1000">
        <img src="resource/desc.png" style="width:322px;height: 490px" >
    </div>
    <div id="start_qa" style="display:none;position: absolute;width: 100%;height:85%;top: 15%;left: 0px;text-align: center;z-index: 1000">
        <div>
            <img id="light_img" src="resource/light.png" style="width:293px;height: 293px;" >
            <div style="width: 100% ;position: absolute;top: 54px;left: 0;text-align: center">
                <img id="book_img" src="resource/book.png" style="width:184px;height: 220px;" >
            </div>
            <div style="margin-top: 40px">
                <img src="resource/hand.png" style="width:63px;height: 78px;">
            </div>
            <div style="margin-top: 20px">
                <img src="resource/goon_text.png" style="width:158px;height: 25px;">
            </div>
            <div style="width: 100% ;position: absolute;bottom: 10px;left: 0;text-align: center">
                <img src="resource/next.png" style="width:40px;height: 40px;">
            </div>
        </div>
    </div>
    <div id="first_qa" style="position: absolute; text-align: center;top: 50%;width: 100%;z-index:1000;display: none">
        <img id="y_btn" data="yes" src="resource/yes.png" style="width:72px;height:72px;margin-right: 100px"  />
        <img id="n_btn" data="no" src="resource/no.png" style="width:72px;height:72px"  />
    </div>
    <div id="second_qa" style="position: absolute; text-align: center;top: 50%;width: 100%;z-index:1000;display: none">
        <img id="y3_btn" data="y3" src="resource/y3.png" style="width:72px;height:72px;margin-right: 100px"  />
        <img id="y4_btn" data="y4" src="resource/y4.png" style="width:72px;height:72px"  /><br><br>
        <img id="y5_btn" data="y5" src="resource/y5.png" style="width:72px;height:72px;margin-right: 100px"  />
        <img id="y6_btn" data="y6" src="resource/y6.png" style="width:72px;height:72px"  />
    </div>
    <div id="third_qa" style="position: absolute; text-align: center;top: 50%;width: 100%;z-index:1000;display: none">
        <img id="ysly_btn" data="ysly" src="resource/ysly.png" style="width:72px;height:72px;margin-right: 100px"  />
        <img id="hlwjr_btn" data="hlwjr" src="resource/hlwjr.png" style="width:72px;height:72px"  /><br><br>
        <img id="swkj_btn" data="swkj" src="resource/swkj.png" style="width:72px;height:72px;margin-right: 100px"  />
        <img id="qjny_btn" data="qjny" src="resource/qjny.png" style="width:72px;height:72px"  />
    </div>
    <div id="fourth_qa" style="position: absolute; text-align: center;top: 40%;width: 100%;z-index:1000;display: none">
        <div id="fourth_answer" style="margin:0 auto;padding-top:10px;width:293px;height:118px;background-image: url(resource/kuang.png);  -moz-background-size:100% 100%;background-size:100% 100%;">
        </div>
        <div><img id="submit_btn" data="submit" src="resource/submit.png" style="width:59px;height:59px"></div>
        <div id="fourth_choice" >
            <div style="margin-left: 50px;width:60px;height:60px;float: left;margin-top: 10px"><img id="zqjy_btn" data="zqjy" src="resource/zqjy.png" style="width:60px;height:60px;"  /></div>
            <div style="margin-left: 50px;width:60px;height:60px;float: left;margin-top: 10px"><img id="hbjc_btn" data="hbjc" src="resource/hbjc.png" style="width:60px;height:60px;"  /></div>
            <div style="margin-left: 50px;width:60px;height:60px;float: left;margin-top: 10px"><img id="rhyy_btn" data="rhyy" src="resource/rhyy.png" style="width:60px;height:60px;"  /></div>
            <div style="margin-left: 50px;width:60px;height:60px;float: left;margin-top: 10px"><img id="xybzbx_btn" data="xybzbx" src="resource/xybzbx.png" style="width:60px;height:60px;"  /></div>
            <div style="margin-left: 50px;width:60px;height:60px;float: left;margin-top: 10px"><img id="zcgl_btn" data="zcgl" src="resource/zcgl.png" style="width:60px;height:60px;"  /></div>
            <div style="margin-left: 50px;width:60px;height:60px;float: left;margin-top: 10px"><img id="hjs_btn" data="hjs" src="resource/hjs.png" style="width:60px;height:60px;"  /></div>
            <div style="clear: both"></div>
        </div>
    </div>
    
</div>

<!-- 第三页 -->
<div  id="end_page" style="display: none" class="page_full">
    <img id="bg3" src="resource/bg.png" width="100%" height="100%" />
    <div style="position: absolute; text-align: center;top: 70px;width: 100%">
        <img id="logo_end" src="resource/logo_end.png" style="width:235px;height:353px"  />
    </div>
    <div style="position: absolute; text-align: center;bottom: 30px;width: 100%;z-index: 1000">
        <div style="margin-bottom: 50px">
            <img id="exit_btn" src="resource/exit_btn.png" style="width:57px;height: 83px;"/>
            <img id="replay_btn" src="resource/replay_btn.png" style="width:57px;height: 83px;margin-left: 50px"/>
        </div>
        <div style="margin-right: 30px"><img id="logo_bottom_end" src="resource/logo_bottom.png" style="width:127px;height: 27px"  /></div>
    </div>
</div>
</body>
</html>

<script>
    // 68,图书开始;70:图书结束;71:第一题;79:第一题结束;80:正确;83正确结束;83错误;92错误结束
    var firstQA = {start:72,end:80,correctStart:80,correctEnd:83,wrong1Start:83,wrong1End:86,wrong2End:86,wrong2End:92}

    var winWidth = $(window).width();
    var winHeight = $(window).height();
    $().ready(function () {
        //在js中设置canvas的宽高时，如果设置方式不正确，或者在cass中设置时，在绘制图像时就会出现拉伸的情况。这是因为canvas的默认宽高为300px*150px，在css中设置canvas的宽高，实际上是把canvas在300px*150px的基础上进行了拉伸。所以绘制出来的图像会发生变形。
        $("#cv").get(0).width = 288/2;

        $("#cv").get(0).height = 381/2;
        var mycv = document.getElementById("cv");

        var myctx = mycv.getContext("2d");

        var imgs = ["resource/01.png","resource/02.png","resource/03.png","resource/04.png"];
        var animation = AnimationImages.init(myctx,imgs);

        //五秒后切换场景1
        setInterval(function () {
            $("#loading_page").hide();
            $("#start_page").show();
        },5000)

        //第一题
        $("#y_btn").click(function () {
            correct(this,"first_qa"
                        ,80
                        ,82.5
                        ,"second_qa"
                        ,92.8
                        ,100);
        })

        var correct = function (btn,thisId,correctStartTime,correctEndTime,nextId,nextStartTime,nextEndTime) {
            var $this = $(btn);
            btn.src = "resource/"+$this.attr("data")+"_highlight.png";
            setTimeout(function () {
                //正确
                var video = document.querySelector("video");
                video.currentTime = correctStartTime;
                $("#" + thisId).hide();
                btn.src = "resource/"+$this.attr("data")+".png";
                video.play();
                pauseVideo(video, correctEndTime, function () {
                    //第一个问题
                    video.currentTime = nextStartTime;
                    video.play();
                    pauseVideo(video, nextEndTime, function () {
                        //第二个问题
                        $("#" + nextId).fadeIn();
                    });
                });
            }.bind(this), 500)
        }

        var fTimes = 0

        $("#n_btn").click(function () {
            wrong(this,++fTimes,"first_qa"
                    ,79
                    ,83
                    ,86
                    ,86.5
                    ,92);
        })

        var wrong = function (btn,times,thiId,questionTime,wrong1startTime,wrong1EndTime,wrong2StartTime,wrong2EndTime) {
            var $this = $(btn);
            btn.src = "resource/"+$this.attr("data")+"_highlight.png";
            setTimeout(function () {
                //正确
                var video = document.querySelector("video");
                if(times<2) {
                    video.currentTime = wrong1startTime;
                    $("#"+thiId).hide();
                    btn.src = "resource/"+$this.attr("data")+".png"
                    video.play();
                    pauseVideo(video, wrong1EndTime, function () {
                        //第一个问题
                        video.currentTime = questionTime;
                        $("#"+thiId).fadeIn();
                    });
                }else{
                    video.currentTime = wrong2StartTime;
                    $("#"+thiId).hide();
                    btn.src = "resource/"+$this.attr("data")+".png"
                    video.play();
                    pauseVideo(video, wrong2EndTime, function () {
                        //第一个问题
                        video.currentTime = questionTime;
                        $("#"+thiId).fadeIn();
                    });
                }
            }.bind(this),500)
        }

        //第2题
        $("#y3_btn").click(function () {
            correct(this,"second_qa"
                    ,100.5
                    ,104
                    ,"third_qa"
                    ,114.8
                    ,120);
        })

        var sTimes = 0

        $("#y4_btn,#y5_btn,#y6_btn").click(function () {
            wrong(this,++sTimes,"second_qa"
                    ,100
                    ,104.5
                    ,107
                    ,108.3
                    ,114);
        })


        //第3题
        $("#hlwjr_btn").click(function () {
            correct(this,"third_qa"
                    ,121
                    ,124
                    ,"fourth_qa"
                    ,135
                    ,141);
        })

        var tTimes = 0

        $("#ysly_btn,#qjny_btn,#swkj_btn").click(function () {
            wrong(this,++tTimes,"third_qa"
                    ,120
                    ,125
                    ,128
                    ,128.5
                    ,134);
        })

        //第四题
        var forTimes=0;
        $("#fourth_choice img").click(function () {
            var $this = $(this);
            this.src = "resource/"+$this.attr("data")+"_highlight.png";
            setTimeout(function () {
                $this.hide();
                var data = $this.attr("data");
                this.src = "resource/"+data+".png";
                var $img = $("<img id=\""+data+"_answer\" data=\""+$this.attr("data")+"\" src=\"resource/"+$this.attr("data")+".png\" style=\"width:40px;height:40px;\"/>")
                var $dom = $("<div style=\"margin-left: 40px;width:40px;height:40px;float: left;margin-top: 5px\">"+ "</div>");
                $dom.append($img);
                $("#fourth_answer").append($dom);
                $img.click(function () {
                    var $thisImg = $(this);
                    var data = $thisImg.attr("data");
                    this.src = "resource/"+data+"_highlight.png";
                    setTimeout(function () {
                        $thisImg.parent().remove();
                        $this.show();
                    }.bind(this), 500);
                });

            }.bind(this), 500);
        })
        $("#submit_btn").click(function () {
            var corrects = 0;
            $("#fourth_answer img").each(function () {
                var data = $(this).attr("data");
                if(data!="zqjy" && data!="hbjc"){
                    corrects ++;
                }else{
                    corrects --;
                }
            });
            if(corrects==4){
                setTimeout(function () {
                    //正确
                    var video = document.querySelector("video");
                    video.currentTime = 141.5;
                    $("#fourth_qa").hide();
                    video.play();
                    pauseVideo(video, 144, function () {
                        //第一个问题
                        video.currentTime = 155.5;
                        video.play();
                    });
                }.bind(this), 500);
            }else{
                wrong(this,++forTimes,"fourth_qa"
                        ,141
                        ,145
                        ,148
                        ,148.8
                        ,154);
            }

            setTimeout(function () {
                $("#fourth_answer").html("");
                $("#fourth_choice img").show();
            },1000);

        })

        $("#go_btn").click(function () {
            $("#start_page").hide();
            $("#pageWrap").show();
            playvideo();
        });

        $("#desc").click(function () {
            $(this).hide();
            var video = document.querySelector("video");
            video.currentTime = 45;
            video.play();
            pauseVideo(video,68,function () {
                //第一个问题
                $("#start_qa").fadeIn().find("#light_img").addClass("light_rotate");
            });
        })
        $("#start_qa").click(function () {
            $(this).hide();
            $(this).find("#light_img").removeClass("light_rotate")
            var video = document.querySelector("video");
            video.currentTime = 71;
            video.play();
            pauseVideo(video,79,function () {
                //第一个问题
                $("#first_qa").fadeIn();
            });
        })
        
        var playvideo = function () {
            var video = document.querySelector("video");
            video.play();

            setTimeout(function () {
                video.currentTime = 0;
                pauseVideo(video,44,function () {
                    //第一个问题
                    $("#desc").fadeIn().find("#light_img").addClass("light_rotate")
                });
            },1000);
        }
        //调整视频大小
        $(window).on('resize', function () {
            zoomResize();
        });
        zoomResize();

        //视频播放完成事件
        var video = document.querySelector("video");
        video.addEventListener("ended",function(){
            $("#pageWrap").hide();
            $("#end_page").show();
        });
        //重播事件
        $("#replay_btn").click(function () {
            $("#pageWrap").show();
            $("#end_page").hide();
            playvideo();
        });

    })

    function pauseVideo(videoId,pauseTime,callback) {
        var videoTimeInterval = setInterval(function () {
            if (videoId.currentTime.toFixed(1) == pauseTime) {
                videoId.pause();
                callback();
                clearInterval(videoTimeInterval);
            }
        }, 10);
    }

    var AnimationImages = {
        init:function (ctx,imgs) {//构造方法
            var images = new Array();
            var length = imgs.length;
            var loadCallBack = function(index){
                length--;
                if(length==0){
                    ctx.drawImage(images[0],0,0,288,381,0,0,288/2,381/2);
                    var times = 0,count=images.length;
                    setInterval(function () {
                        ctx.clearRect(0,0,288,381);
                        ctx.drawImage(images[times%count],0,0,288,381,0,0,288/2,381/2);
                        times++;
                    },1000/6);
                }
            }
            for(var i=0;i<imgs.length;++i){
                images[i] = this.addImage(imgs[i],i,loadCallBack.bind(this));
            }
            return {

            };
        },
        addImage:function(src,index,loadCallBack){
            var img = new Image();
            img.src = src;
            img.onload = function(){
                loadCallBack(index_bak);
            };
            return img;
        }

    }


    //video屏幕自适应
    function zoomResize() {
        var ratio = parseFloat(innerWidth / 810);
        $(".zoom-page").css("transform", "scale(" + ratio + "," + ratio + ")");
        $(".zoom-page").css("-webkit-transform", "scale(" + ratio + "," + ratio + ")");
        $(".zoom-page").css("height", innerHeight / ratio + 1);
//    zoomk();
    }

</script>

